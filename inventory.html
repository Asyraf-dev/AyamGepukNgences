<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inventory System</title>
  <style>
    /* General Body and Layout Styles */
body {
  font-family: 'Arial', sans-serif;
  background-color: #f4f7fc;
  padding: 20px;
  margin: 0;
}

h1 {
  text-align: center;
  color: #333;
  font-size: 2em;
  font-weight: 700;
  margin-bottom: 20px;
}

/* Container for Content */
.container {
  max-width: 1000px;
  margin: 0 auto;
  padding: 20px;
  background-color: #fff;
  border-radius: 8px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

/* Buttons and Action Buttons Styling */
.buttons {
  margin-top: 20px;
  text-align: center;
}

.buttons button {
  padding: 10px 20px;
  font-size: 1em;
  background-color: #28a745;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  margin: 10px;
  transition: background-color 0.3s ease, transform 0.3s ease;
}

.buttons button:hover {
  background-color: #218838;
  transform: translateY(-3px);
}

.buttons .copy-button {
  background-color: #007bff;
}

.buttons .copy-button:hover {
  background-color: #0056b3;
}

.buttons .print-button {
  background-color: #ffc107;
}

.buttons .print-button:hover {
  background-color: #e0a800;
}

.buttons .view-history-button {
  background-color: #6c757d; /* Gray for history view */
  font-size: 1em;
}

.buttons .view-history-button:hover {
  background-color: #5a6268;
}

/* Scroll to Bottom Button */
.scroll-btn {
  position: fixed;
  bottom: 20px; /* Position from the bottom of the screen */
  right: 20px;  /* Position from the right of the screen */
  background-color: #007bff;
  color: white;
  border: none;
  border-radius: 50%;
  padding: 15px;
  font-size: 18px;
  cursor: pointer;
  transition: background-color 0.3s ease;
  z-index: 1000;
  display: none; /* Hidden by default, shown when scrolled down */
}

.scroll-btn:hover {
  background-color: #0056b3;
}

.scroll-btn:focus {
  outline: none;
}

/* Scroll To Bottom Button Visible when Scrolled */
.show-btn {
  display: block;
}

/* Inventory Table Styling */
.inventory-list {
  margin-bottom: 20px;
  margin-top: 20px;
  border-collapse: collapse;
  width: 100%;
}

.inventory-list th,
.inventory-list td {
  padding: 10px;
  border: 1px solid #ddd;
  text-align: center;
}

.inventory-list th {
  background-color: #f1f1f1;
}

.inventory-list td {
  background-color: #fff;
}

.inventory-list td input[type="checkbox"] {
  margin: 0;
}

/* Checksheet Section */
.checksheet {
  margin-top: 30px;
  padding: 15px;
  background-color: #f1f1f1;
  border-radius: 8px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.checksheet h2 {
  font-size: 1.5em;
  margin-bottom: 20px;
}

.checksheet ul {
  list-style-type: none;
  padding: 0;
}

.checksheet ul li {
  padding: 10px 0;
  font-size: 1.1em;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid #ddd;
}

.checksheet li span {
  flex: 2;
}

.checksheet li input[type="number"],
.checksheet li select {
  width: 100px;
  padding: 5px;
  margin-left: 10px;
  font-size: 1em;
  border-radius: 4px;
  border: 1px solid #ddd;
}

/* Responsive Styles for Mobile */
@media (max-width: 768px) {
  body {
    padding: 10px;
  }

  .container {
    width: 100%;
    padding: 15px;
  }

  .buttons button {
    padding: 8px 15px;
    font-size: 0.9em;
  }

  .buttons .copy-button,
  .buttons .print-button,
  .buttons .view-history-button {
    font-size: 0.9em;
    padding: 8px 15px;
  }

  .inventory-list th,
  .inventory-list td {
    padding: 8px;
  }

  .checksheet ul li {
    font-size: 1em;
  }
}

/* Media Queries for Small Smartphones */
@media (max-width: 480px) {
  .scroll-btn {
    font-size: 16px;
    padding: 12px;
    right: 15px;
    bottom: 15px;
  }

  .scroll-btn:hover {
    background-color: #003d8c;
  }

  .buttons button {
    padding: 8px 15px;
    font-size: 0.9em;
  }
}



  </style>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

</head>
<body>
  <div class="container">
    <h1>Inventory System</h1>

    <!-- Filter Section -->
    <div class="filter-container">
      <label for="categoryFilter">Filter by Category:</label>
      <select id="categoryFilter" onchange="filterItems()">
        <option value="all">All Items</option>
        <option value="barang_pasaran">Barang Pasar</option>
        <option value="barang_runcit">Barang Runcit</option>
        <option value="barang_kering">Barang Kering</option>
      </select>
    </div>

    <!-- Inventory Table -->
    <table class="inventory-list" id="inventoryTable">
      <thead>
        <tr>
          <th>Item</th>
          <th>Select</th>
        </tr>
      </thead>
      <tbody>
        <!-- Dynamic Inventory Items will be loaded here -->
      </tbody>
    </table>

    <!-- Checksheet Section -->
    <div class="checksheet">
      <h2>Checksheet Items for Today</h2>
      <p id="timestamp"></p> <!-- Timestamp will be displayed here -->
      <ul id="checksheetList">
        <!-- Selected items with quantities will be listed here -->
      </ul>
    </div>

    <!-- Action Buttons -->
<div class="buttons">
  <button class="copy-button" onclick="copyChecksheet()">Copy Checksheet</button>
  <button class="print-button" onclick="printChecksheet()">Print Checksheet</button>
  <button onclick="saveToFirebase()">Save to Firebase</button>

  <!-- New buttons -->
  <button class="view-history-button" onclick="window.location.href='inventoryhistory.html';">View History Checklist</button>
  <button class="view-history-button" onclick="window.location.href='display.html';">Go to Order View</button>
</div>
<!-- Scroll to Bottom Button -->
<button id="scrollBottomBtn" onclick="scrollToBottom()" class="scroll-btn">
  &#8681; Scroll to Bottom
</button>



  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyC8piEU-44jNKKaiWZlp2mEmDFwbO6FsrY",
      authDomain: "inventory-change-1f2c9.firebaseapp.com",
      databaseURL: "https://inventory-change-1f2c9-default-rtdb.firebaseio.com",
      projectId: "inventory-change-1f2c9",
      storageBucket: "inventory-change-1f2c9.firebasestorage.app",
      messagingSenderId: "657658084944",
      appId: "1:657658084944:web:77898bcda22fcddf275b55",
      measurementId: "G-1BRQB0GFJX"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Inventory Data
    const inventoryData = {
      barang_pasaran: [
        { name: "Kobis" },
        { name: "Timun" },
        { name: "Limau" },
        { name: "Daun Sup" },
        { name: "Daun Pandan" },
        { name: "Salad" },
        { name: "Halia" },
        { name: "Kunyit Hidup" },
        { name: "Lengkuas" },
        { name: "Serai" },
        { name: "Tempe" },
        { name: "Serbuk Kunyit" },
        { name: "Cili Padi" },
        { name: "Cili Masak" },
        { name: "Cili Padi Masak" },
        { name: "Suun" },
        { name: "Cincau" }
      ],
      barang_runcit: [
        { name: "Gula" },
        { name: "Susu" },
        { name: "Garam" },
        { name: "Ajinomoto" },
        { name: "Tumix Pati Ayam" },
        { name: "Maggi Cukup Rasa" },
        { name: "Tepung Gandung" },
        { name: "Sabun Daia" },
        { name: "Sabun Sunlight" },
        { name: "Beras" },
        { name: "Maggi" },
        { name: "Sirap" },
        { name: "Teh" },
        { name: "Kopi" },
        { name: "Sunquick" },
        { name: "Selalsih" },
        { name: "Nescaffe" },
        { name: "Laici" },
        { name: "Extra Mangga" },
        { name: "Extra Anggur" },
        { name: "Ketumbar" },
        { name: "Buah Keras" },
        { name: "Kicap" },
        { name: "Kertas C" },
        { name: "Kertas D" },
        { name: "Sos Cili" },
        { name: "Polistrine" },
        { name: "Bowl Bakso" },
        { name: "Sudu Plastik" },
        { name: "Garfu Pelastik" },
        { name: "Plastik 12x16" },
        { name: "Plastik 16x19" },
        { name: "Plastik 6x7" },
        { name: "Plastik 7x8" },
        { name: "Plastik Singlet 4.5" },
        { name: "Plastik Kicap" },
        { name: "Getah Belacan" },
        { name: "Pen & Maker" },
        { name: "Daging" }
      ],
      barang_kering: [
        { name: "Bebola Bakso" },
        { name: "Ayam" }
      ]
    };
    
    function scrollToBottom() {
  window.scrollTo({
    top: document.body.scrollHeight,
    behavior: 'smooth'
  });
}
// Function to handle scroll event and show the button when scrolled down
window.onscroll = function() {
  const scrollBtn = document.getElementById("scrollBottomBtn");
  if (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) {
    scrollBtn.classList.add("show-btn");  // Show button when scrolled down
  } else {
    scrollBtn.classList.remove("show-btn");  // Hide button when scrolled to top
  }
};


    // Function to display the items in the table
    function displayItems(category = 'all') {
      const tableBody = document.getElementById("inventoryTable").getElementsByTagName("tbody")[0];
      tableBody.innerHTML = ''; // Clear existing items

      let filteredItems = [];
      if (category === 'all') {
        filteredItems = [
          ...inventoryData.barang_pasaran,
          ...inventoryData.barang_runcit,
          ...inventoryData.barang_kering
        ];
      } else {
        filteredItems = inventoryData[category];
      }

      filteredItems.forEach(item => {
        const row = tableBody.insertRow();
        const cell1 = row.insertCell(0);
        cell1.textContent = item.name;

        const cell2 = row.insertCell(1);
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.onclick = () => addToChecksheet(item.name);
        cell2.appendChild(checkbox);
      });
    }

    // Function to add selected item to checksheet
    function addToChecksheet(itemName) {
    const checksheetList = document.getElementById("checksheetList");

    // Check if the item is already in the checksheet
    if ([...checksheetList.children].some(item => item.textContent.includes(itemName))) {
      return; // If it's already there, do nothing
    }

    // Determine the category of the item
    let category = '';
    if (inventoryData.barang_pasaran.some(item => item.name === itemName)) {
      category = 'barang_pasaran';
    } else if (inventoryData.barang_runcit.some(item => item.name === itemName)) {
      category = 'barang_runcit';
    } else if (inventoryData.barang_kering.some(item => item.name === itemName)) {
      category = 'barang_kering';
    }

    // Check if a list for this category already exists in the checksheet
    let categorySection = document.getElementById(`${category}-section`);
    if (!categorySection) {
      // If not, create a new section for this category
      categorySection = document.createElement("div");
      categorySection.id = `${category}-section`;
      categorySection.innerHTML = `<h3>${capitalizeFirstLetter(category.replace('_', ' '))}</h3>`;
      checksheetList.appendChild(categorySection);
    }

    // Create a list item for the selected item
    const li = document.createElement("li");

    // Item name
    const itemText = document.createElement("span");
    itemText.textContent = itemName;
    li.appendChild(itemText);

    // Quantity input
    const quantityInput = document.createElement("input");
    quantityInput.type = "number";
    quantityInput.value = 1;
    li.appendChild(quantityInput);

    // Unit selection
    const unitSelect = document.createElement("select");
    const option1 = document.createElement("option");
    option1.value = "pcs";
    option1.textContent = "pcs";
    const option2 = document.createElement("option");
    option2.value = "kg";
    option2.textContent = "kg";
    unitSelect.appendChild(option1);
    unitSelect.appendChild(option2);
    li.appendChild(unitSelect);

    // Append the list item under the appropriate category section
    categorySection.appendChild(li);
  }

  // Function to capitalize the first letter of each word in the string
  function capitalizeFirstLetter(string) {
    return string.charAt(0).toUpperCase() + string.slice(1);
  }

    // Function to filter items by category
    function filterItems() {
      const category = document.getElementById("categoryFilter").value;
      displayItems(category);
    }

    // Add timestamp
    function addTimestamp() {
      const timestamp = new Date().toLocaleString();
      document.getElementById("timestamp").textContent = `Generated on: ${timestamp}`;
    }

    // Copy checksheet to clipboard with proper categorization
  function copyChecksheet() {
    const checksheetItems = [];
    const checksheetList = document.getElementById("checksheetList").children;

    // Loop through each category section and its items
    for (let i = 0; i < checksheetList.length; i++) {
      const categorySection = checksheetList[i];
      const categoryTitle = categorySection.querySelector("h3").textContent;
      const items = categorySection.querySelectorAll("li");

      // Add category title to the list
      checksheetItems.push(`${categoryTitle}:`);

      // Loop through each item in the category
      items.forEach(item => {
        const itemName = item.children[0].textContent;
        const quantity = item.children[1].value;
        const unit = item.children[2].value;
        checksheetItems.push(`${itemName} - ${quantity} ${unit}`);
      });

      checksheetItems.push(""); // Add an empty line between categories
    }

    // Add timestamp
    const timestamp = new Date().toLocaleString();
    checksheetItems.unshift(`Generated on: ${timestamp}\n`); // Add timestamp at the top
    const checksheetText = checksheetItems.join("\n");

    // Copy to clipboard
    navigator.clipboard.writeText(checksheetText).then(() => {
      alert('Checksheet copied to clipboard!');
    });
  }

  // Print checksheet with proper categorization
  function printChecksheet() {
    const checksheetItems = [];
    const checksheetList = document.getElementById("checksheetList").children;

    // Loop through each category section and its items
    for (let i = 0; i < checksheetList.length; i++) {
      const categorySection = checksheetList[i];
      const categoryTitle = categorySection.querySelector("h3").textContent;
      const items = categorySection.querySelectorAll("li");

      // Add category title to the list
      checksheetItems.push(`<h3>${categoryTitle}</h3>`);

      // Loop through each item in the category
      items.forEach(item => {
        const itemName = item.children[0].textContent;
        const quantity = item.children[1].value;
        const unit = item.children[2].value;
        checksheetItems.push(`<p>${itemName} - ${quantity} ${unit}</p>`);
      });

      checksheetItems.push(""); // Add an empty line between categories
    }

    // Add timestamp
    const timestamp = new Date().toLocaleString();
    const printContent = `<html><head><title>Print Checksheet</title><style>
                            body { font-family: Arial, sans-serif; padding: 20px; font-size: 16px; }
                            h3 { margin-top: 20px; }
                            p { margin-bottom: 5px; }
                            .timestamp { text-align: center; font-size: 14px; margin-bottom: 20px; }
                          </style></head><body>
                          <h2>Checksheet Items for Today</h2>
                          <p class="timestamp">Generated on: ${timestamp}</p>
                          ${checksheetItems.join("")}
                          </body></html>`;

    // Open the print window and trigger print
    const printWindow = window.open('', '', 'height=600,width=800');
    printWindow.document.write(printContent);
    printWindow.document.close();
    printWindow.print();
  }

  // Save checksheet to Firebase with proper categorization
function saveToFirebase() {
  const checksheetItems = [];
  const checksheetList = document.getElementById("checksheetList").children;

  // Loop through each category section and its items
  for (let i = 0; i < checksheetList.length; i++) {
    const categorySection = checksheetList[i];
    const categoryTitle = categorySection.querySelector("h3").textContent;
    const items = categorySection.querySelectorAll("li");

    items.forEach(item => {
      const itemName = item.children[0].textContent;
      const quantity = item.children[1].value;
      const unit = item.children[2].value;

      checksheetItems.push({
        category: categoryTitle,
        item: itemName,
        quantity: quantity,
        unit: unit
      });
    });
  }

  // Save to Firebase
  const today = new Date().toISOString().split('T')[0]; // Get today's date (YYYY-MM-DD)
  const ref = db.ref('checklists/' + today);

  // Get the existing data for today's date (if any) and append the new items
  ref.once('value', (snapshot) => {
    const existingItems = snapshot.val() ? snapshot.val().items : [];
    const allItems = existingItems.concat(checksheetItems); // Combine existing and new items

    // Update Firebase with the combined items
    ref.update({
      items: allItems
    }, (error) => {
      if (error) {
        alert('Error saving to Firebase: ' + error);
      } else {
        alert('Checksheet saved to Firebase successfully!');
      }
    });
  });
}

    // Initialize the page by displaying all items and adding timestamp
    window.onload = () => {
      displayItems(); // Show all items on page load
      addTimestamp(); // Add timestamp to the checksheet
    };
  </script>
</body>
</html>
